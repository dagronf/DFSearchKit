<!DOCTYPE html>
<html lang="en">
  <head>
    <title>  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> Docs</a> (90% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" />
          Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex.html">DFSearchIndex</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/IndexType.html">– IndexType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/CreateProperties.html">– CreateProperties</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/TermCount.html">– TermCount</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/TermState.html">– TermState</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/SearchResult.html">– SearchResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/ProgressiveSearch.html">– ProgressiveSearch</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/AsyncController.html">– AsyncController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/File.html">– File</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSearchIndex/Memory.html">– Memory</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSummarizer.html">DFSummarizer</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSummarizer/Sentence.html">– Sentence</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DFSummarizer/Paragraph.html">– Paragraph</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/DFSearchIndexAsyncControllerProtocol.html">DFSearchIndexAsyncControllerProtocol</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='dfsearchkit' class='heading'>DFSearchKit</h1>

<p>A framework implementing a search index using SKSearchKit for both Swift and Objective-C</p>
<h2 id='why' class='heading'>Why?</h2>

<p>I was interesting in learning about SKSearchKit and wanted a nice simple object to abstract away some of the unpleasantries when dealing with a C-style interface in Swift using native Swift types</p>
<h2 id='usage' class='heading'>Usage</h2>

<p>Find API references here &ndash; <a href="https://github.com/dagronf/DFSearckKit/blob/master/docs/index.html">https://github.com/dagronf/DFSearckKit/blob/master/docs/index.html</a></p>

<p>The base library is split into three classes and an async controller</p>
<h2 id='classes' class='heading'>Classes</h2>
<h3 id='dfsearchindex-memory' class='heading'>DFSearchIndex.Memory</h3>

<p>A class inheriting from DFSearchIndex that implements an in-memory index.</p>
<pre class="highlight swift"><code><span class="k">guard</span> <span class="k">let</span> <span class="nv">indexer</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">Memory</span><span class="o">.</span><span class="kt">Create</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
   <span class="nf">assert</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">documentURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="p">(</span><span class="s">"doc-url://d1.txt"</span><span class="p">)</span><span class="o">!</span>
<span class="n">indexer</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">documentURL</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="s">"This is my first document"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="c1">// &lt;the url for some file on disk&gt;</span>
<span class="n">indexer</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">fileURL</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"application/pdf"</span><span class="p">)</span>

<span class="c1">// ... add more documents</span>

<span class="n">indexer</span><span class="o">.</span><span class="nf">flush</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">searchresult</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="s">"first"</span><span class="p">)</span>

<span class="c1">// Do something with the search results</span>

</code></pre>

<p><code><a href="Classes/DFSearchIndex/Memory.html">DFSearchIndex.Memory</a></code> provides methods to get the raw index data for storing, and to load from data</p>
<h5 id='load-from-a-raw-data-object' class='heading'>Load from a raw Data object</h5>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">indexData</span> <span class="o">=</span> <span class="kt">Data</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">indexer</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">Memory</span><span class="o">.</span><span class="kt">Load</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">indexData</span><span class="p">)</span>
</code></pre>
<h5 id='extract-the-raw-data-object-from-the-search-index' class='heading'>Extract the raw Data object from the search index</h5>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">newIndexData</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="nf">data</span><span class="p">()</span>
</code></pre>
<h3 id='dfsearchindex-file' class='heading'>DFSearchIndex.File</h3>

<p>A class inheriting from DFSearchIndex that allows the creation and use of an index on disk</p>
<pre class="highlight swift"><code><span class="c1">// Create a index on disk</span>
<span class="k">let</span> <span class="nv">newFileURL</span> <span class="o">=</span> <span class="c1">// &lt;some file url&gt;</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">newIndex</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">File</span><span class="o">.</span><span class="kt">Create</span><span class="p">(</span><span class="n">newFileURL</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
   <span class="nf">assert</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Open a file index</span>
<span class="k">let</span> <span class="nv">existingFileURL</span> <span class="o">=</span> <span class="c1">// &lt;some file url&gt;</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">fileIndex</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">File</span><span class="o">.</span><span class="kt">Open</span><span class="p">(</span><span class="n">existingFileURL</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
   <span class="nf">assert</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">documentURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="p">(</span><span class="s">"doc-url://d1.txt"</span><span class="p">)</span><span class="o">!</span>
<span class="n">fileIndex</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">documentURL</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="s">"This is my first document"</span><span class="p">))</span>

<span class="k">let</span> <span class="nv">fileURL</span> <span class="o">=</span> <span class="c1">// &lt;the url for some file on disk&gt;</span>
<span class="n">fileIndex</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">fileURL</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"application/pdf"</span><span class="p">)</span>

<span class="c1">// Flush the index so that it is updated for searching</span>
<span class="n">fileIndex</span><span class="o">.</span><span class="nf">flush</span><span class="p">()</span>

<span class="c1">// Perform a basic search for the work 'first'</span>
<span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="s">"first"</span><span class="p">)</span>

<span class="n">fileIndex</span><span class="o">.</span><span class="nf">save</span><span class="p">()</span>
<span class="n">fileIndex</span><span class="o">.</span><span class="nf">close</span><span class="p">()</span>

</code></pre>
<h3 id='dfsearchindex-asynccontroller' class='heading'>DFSearchIndex.AsyncController</h3>

<p><code><a href="Classes/DFSearchIndex/AsyncController.html">DFSearchIndex.AsyncController</a></code> is a simple controller that takes an index object, and provides a safe method for handling async requests.</p>

<p>For example, to add a number of files asynchronously</p>
<pre class="highlight swift"><code><span class="k">guard</span> <span class="k">let</span> <span class="nv">searchIndex</span> <span class="o">=</span> <span class="kt">DDFSearchIndex</span><span class="o">.</span><span class="kt">Memory</span><span class="o">.</span><span class="nf">create</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
   <span class="nf">assert</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">asyncController</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">AsyncController</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="n">searchIndex</span><span class="p">,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">addTask</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">AsyncController</span><span class="o">.</span><span class="kt">FileTask</span><span class="p">(</span><span class="o">&lt;</span><span class="n">file</span> <span class="n">urls</span> <span class="n">to</span> <span class="n">add</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">asyncController</span><span class="o">.</span><span class="nf">addURLs</span><span class="p">(</span><span class="nv">async</span><span class="p">:</span> <span class="n">addTask</span><span class="p">,</span> <span class="nv">complete</span><span class="p">:</span> <span class="p">{</span> <span class="n">task</span> <span class="k">in</span>
    <span class="c1">// &lt;block that is executed when the files have been added to the index&gt;</span>
<span class="p">})</span>

<span class="o">...</span>

<span class="k">let</span> <span class="nv">removeTask</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">AsyncController</span><span class="o">.</span><span class="kt">FileTask</span><span class="p">(</span><span class="o">&lt;</span><span class="n">file</span> <span class="n">urls</span> <span class="n">to</span> <span class="n">remove</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">asyncController</span><span class="o">.</span><span class="nf">removeURLs</span><span class="p">(</span><span class="nv">async</span><span class="p">:</span> <span class="n">removeTask</span><span class="p">,</span> <span class="nv">complete</span><span class="p">:</span> <span class="p">{</span> <span class="n">task</span> <span class="k">in</span>
    <span class="c1">// &lt;block that is executed when the files have been removed from the index&gt;</span>
<span class="p">})</span>

</code></pre>

<p>Internally the async controller uses an operation queue for handling requests.</p>
<h2 id='searching' class='heading'>Searching</h2>

<p>There are two methods for search</p>
<h3 id='search-all' class='heading'>Search all</h3>

<p>The search all is available on the indexer object, and returns all the results it can get.  As such, for large indexes this may take quite a while to return.  It is provided mostly as a convenience function for small indexes.</p>
<pre class="highlight swift"><code><span class="k">guard</span> <span class="k">let</span> <span class="nv">searchIndex</span> <span class="o">=</span> <span class="kt">DFSearchIndex</span><span class="o">.</span><span class="kt">Memory</span><span class="o">.</span><span class="kt">Create</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
   <span class="nf">assert</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Add some documents...</span>
<span class="k">let</span> <span class="nv">firstURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="p">(</span><span class="s">"doc-url://d1.txt"</span><span class="p">))</span><span class="o">!</span>
<span class="n">searchIndex</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">firstURL</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="s">"This is my first document"</span><span class="p">))</span>

<span class="c1">// Flush the index</span>
<span class="n">searchIndex</span><span class="o">.</span><span class="nf">flush</span><span class="p">()</span>

<span class="c1">// Search for the word 'first'</span>
<span class="k">let</span> <span class="nv">result1</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="s">"first"</span><span class="p">)</span>

<span class="n">searchIndex</span><span class="o">.</span><span class="nf">save</span><span class="p">()</span>
<span class="n">searchIndex</span><span class="o">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre>
<h3 id='progressive-search' class='heading'>Progressive Search</h3>

<p>For large indexes, the results may take quite a while to return.  Thus, the progressive index is more useful by returning limited sets of results progressively, and can be used on a background thread (as SKSearchIndex is thread safe) to progressively retrieve results in another thread (for example)</p>
<pre class="highlight swift"><code><span class="c1">/// ... load documents ...</span>
<span class="k">let</span> <span class="nv">search</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="nf">progressiveSearch</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="s">"dog"</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">hasMoreResults</span> <span class="o">=</span> <span class="kc">true</span>
<span class="k">repeat</span> <span class="p">{</span>
   <span class="k">var</span> <span class="nv">searchChunk</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="nf">next</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

   <span class="c1">// ... do something with searchChunk...</span>

   <span class="n">hasMoreResults</span> <span class="o">=</span> <span class="n">searchChunk</span><span class="o">.</span><span class="n">moreResults</span>
<span class="p">}</span>
<span class="k">while</span> <span class="n">hasMoreResults</span>
</code></pre>
<h2 id='summarization' class='heading'>Summarization</h2>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="c1">// &lt;some text</span>
<span class="k">let</span> <span class="nv">summary</span> <span class="o">=</span> <span class="kt">DFSummarizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1">// Get the number of sentences in the text</span>
<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="nf">sentenceCount</span><span class="p">()</span>
</code></pre>
<h2 id='samples' class='heading'>Samples</h2>

<ul>
<li><code>SearchToy</code> is a (very!) basic UI to show integration</li>
<li><code>dfsearchindex</code> is a simple command line tool (that is very unforgiving to its parameters at this point!) that uses DFSearchIndexFile to create a command line tool interface to the index</li>
</ul>
<h2 id='tests' class='heading'>Tests</h2>

<ul>
<li><p><code>DFSearchKitTests.swift</code></p>

<p>Swift tests.  Comprehensive</p></li>
<li><p><code>DFSearchKitTests_objc.m</code> </p>

<p>Objective-C tests, mainly for validating objc integration</p></li>
<li><p><code>DFSearchIndexAsyncTests.swift</code></p>

<p>Basic test suite to validate the async controller aspect of the library</p></li>
<li><p><code>DFSearchIndexSummaryTests.swift</code></p>

<p>Basic summary tests</p></li>
</ul>
<h2 id='thanks' class='heading'>Thanks</h2>

<p>Mattt Thompson (NSHipster)</p>

<p><a href="http://nshipster.com/search-kit/">http://nshipster.com/search-kit/</a></p>

<p>Marc Charbonneau</p>

<p><a href="https://blog.mbcharbonneau.com/2009/02/26/searchkit-example-project/">https://blog.mbcharbonneau.com/2009/02/26/searchkit-example-project/</a></p>

<p>Apple</p>

<p><a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/SearchKitConcepts/searchKit_concepts/searchKit_concepts.html">https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/SearchKitConcepts/searchKit_concepts/searchKit_concepts.html</a></p>

<p>Philip Dow (SPSearchStore)</p>

<p><a href="https://github.com/phildow/SPSearchStore">https://github.com/phildow/SPSearchStore</a></p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2019-04-28)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
